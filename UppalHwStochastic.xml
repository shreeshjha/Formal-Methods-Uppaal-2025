<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>// Place global declarations here.
typedef struct {
  int x;
  int y;
} Coord;

const int PATH_LENGTH = 23;
const Coord path[PATH_LENGTH] = {
    {0,0}, {1,0}, {2,0}, {3,0}, {4,0}, 
    {4,1}, {4,2}, {4,3}, {4,4}, {5,4},
    {6,4}, {7,4}, {8,4}, {8,5}, {8,6}, 
    {8,7}, {9,7}, {10,7}, {11,7}, {12,7}, 
    {13,7}, {14,7}, {15,7}
};

const Coord mainTower = {15, 7};

clock clk;
int position = 0; // current position on path


const int FIRE_RATE = 3;
const int TURRET_X = 0;
const int TURRET_Y = 1;
const int TURRET_RANGE = 1;

bool e1_in_range = false;
bool e2_in_range = false;


int e1_health = 2;
int e2_health = 2;

int e1_pos = 0;
int e2_pos = 0;

int lives = 5;

// === Configuration VI: Assignment ===
const int basic_x[1] = {5};
const int basic_y[1] = {5};

const int cannon_x[4] = {8, 8, 14, 14};
const int cannon_y[4] = {2, 6, 2, 6};

const int sniper_x[2] = {2, 11};
const int sniper_y[2] = {3, 5};


int turret_count = 0;


</declaration>
	<template>
		<name>TurretAI</name>
		<parameter>int x, int y</parameter>
		<declaration>clock t;
</declaration>
		<location id="id0" x="0" y="0">
			<name x="-10" y="-34">Idle</name>
			<label kind="exponentialrate" x="-10" y="34">FIRE_RATE</label>
		</location>
		<location id="id1" x="0" y="85">
			<name x="-10" y="51">Firing</name>
			<label kind="exponentialrate" x="-10" y="119">1.0</label>
		</location>
		<init ref="id0"/>
		<transition id="id2">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="assignment" x="-118" y="89">turret_count--</label>
			<nail x="-136" y="93"/>
		</transition>
		<transition id="id3">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="guard" x="25" y="-17">t&gt;=FIRE_RATE</label>
			<label kind="assignment" x="263" y="-51">t = 0,
turret_count++,
e1_in_range = abs(path[e1_pos].x - TURRET_X) + abs(path[e1_pos].y - TURRET_Y) &lt;= TURRET_RANGE,
e2_in_range = abs(path[e2_pos].x - TURRET_X) + abs(path[e2_pos].y - TURRET_Y) &lt;= TURRET_RANGE,
e1_health = (e1_in_range &amp;&amp; e1_health &gt; 0) ? e1_health - 1 : e1_health,
e2_health = (e2_in_range &amp;&amp; e2_health &gt; 0) ? e2_health - 1 : e2_health</label>
		</transition>
	</template>
	<template>
		<name>EnemyTemplate</name>
		<parameter>const int id</parameter>
		<location id="id4" x="0" y="0">
			<name x="-10" y="-34">Spawned</name>
			<label kind="exponentialrate" x="-10" y="34">1.0</label>
		</location>
		<location id="id5" x="-68" y="68">
			<name x="-78" y="34">Moving</name>
			<label kind="exponentialrate" x="-78" y="102">1.0</label>
		</location>
		<location id="id6" x="76" y="68">
			<name x="66" y="34">Done</name>
		</location>
		<location id="id7" x="297" y="-144">
			<name x="287" y="-178">Goal</name>
		</location>
		<location id="id8" x="-68" y="229">
			<name x="-78" y="195">Killed</name>
		</location>
		<init ref="id4"/>
		<transition id="id9">
			<source ref="id5"/>
			<target ref="id8"/>
			<label kind="guard" x="-68" y="114">(id == 1 &amp;&amp; e1_health == 0) || (id == 2 &amp;&amp; e2_health == 0)</label>
		</transition>
		<transition id="id10">
			<source ref="id5"/>
			<target ref="id7"/>
			<label kind="guard" x="-50" y="-72">(position &gt;= PATH_LENGTH - 1) || 
(path[position].x == mainTower.x &amp;&amp; path[position].y == mainTower.y)</label>
			<label kind="assignment" x="-50" y="-38">lives = lives - 1</label>
		</transition>
		<transition id="id11">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="guard" x="-50" y="34">position == PATH_LENGTH - 1</label>
		</transition>
		<transition id="id12">
			<source ref="id5"/>
			<target ref="id5"/>
			<label kind="guard" x="-93" y="85">clk&gt;=1 &amp;&amp;
position &lt; PATH_LENGTH - 1 &amp;&amp;
((id == 1 &amp;&amp; e1_health &gt; 0) || (id == 2 &amp;&amp; e2_health &gt; 0))</label>
			<label kind="assignment" x="-107" y="84">clk=0, position=position+1,
e1_pos = (id == 1 ? position : e1_pos),
e2_pos = (id == 2 ? position : e2_pos)</label>
			<nail x="-119" y="76"/>
		</transition>
		<transition id="id13">
			<source ref="id4"/>
			<target ref="id5"/>
			<label kind="select" x="-50" y="-17">i : int[0,1]</label>
			<label kind="guard" x="-50" y="0">i == 0</label>
			<label kind="assignment" x="-50" y="34">clk=0</label>
		</transition>
	</template>
	<system>// Place template instantiations here.
E1 = EnemyTemplate(1);
E2 = EnemyTemplate(2);
T = TurretAI(0, 0);

Basic1 = TurretAI(basic_x[0], basic_y[0]);
Cannon1 = TurretAI(cannon_x[0], cannon_y[0]);
Cannon3 = TurretAI(cannon_x[1], cannon_y[1]);
Cannon4 = TurretAI(cannon_x[2], cannon_y[2]);
Sniper1 = TurretAI(sniper_x[0], sniper_y[0]);
Sniper2 = TurretAI(sniper_x[1], sniper_y[1]);

system E1, E2, T, Basic1, Cannon1, Cannon3, Cannon4, Sniper1, Sniper2;



</system>
	<queries>
		<query>
			<formula>E[&lt;=100;1000](max: turret_count)





</formula>
			<comment/>
			<result outcome="success" type="quantity" value="203.612 ± 0.132629 (95% CI)" timestamp="2025-04-13 11:47:49 +0200">
				<details>203.612 ± 0.132629 (95% CI)</details>
				<plot title="Probability Density Distribution" xaxis="max: turret_count" yaxis="probability density">
					<series title="density" type="b(1.000000)" color="0x0000ff" encoding="csv">196.0,0.001
197.0,0.002
198.0,0.008
199.0,0.025
200.0,0.044
201.0,0.076
202.0,0.122
203.0,0.192
204.0,0.185
205.0,0.159
206.0,0.106
207.0,0.052
208.0,0.02
209.0,0.008
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">203.612,0.0
203.612,0.192
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=14
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [196, 209]
Mean estimate of displayed sample: 203.612 ± 0.132629 (95% CI)</comment>
				</plot>
				<plot title="Probability Distribution" xaxis="max: turret_count" yaxis="probability">
					<series title="probability" type="b(1.000000)" color="0x0000ff" encoding="csv">196.0,0.001
197.0,0.002
198.0,0.008
199.0,0.025
200.0,0.044
201.0,0.076
202.0,0.122
203.0,0.192
204.0,0.185
205.0,0.159
206.0,0.106
207.0,0.052
208.0,0.02
209.0,0.008
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">203.612,0.0
203.612,0.192
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=14
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [196, 209]
Mean estimate of displayed sample: 203.612 ± 0.132629 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Distribution" xaxis="max: turret_count" yaxis="probability">
					<series title="cumulative" type="l" color="0x000000" encoding="csv">196.0,0.0
197.0,0.001
198.0,0.003
199.0,0.011
200.0,0.036
201.0,0.08
202.0,0.156
203.0,0.278
204.0,0.47
205.0,0.655
206.0,0.814
207.0,0.92
208.0,0.972
209.0,0.992
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">203.612,0.0
203.612,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=14
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [196, 209]
Mean estimate of displayed sample: 203.612 ± 0.132629 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Confidence Intervals" xaxis="max: turret_count" yaxis="probability">
					<series title="upper limit" type="k" color="0x0000dd" encoding="csv">196.0,0.003682083896865672
197.0,0.005558924279826673
198.0,0.008742023238478303
199.0,0.019596628222016514
200.0,0.04949291171801237
201.0,0.09857977904790216
202.0,0.17999718498898634
203.0,0.3068938177281916
204.0,0.5014836820760212
205.0,0.6844700767243275
206.0,0.8376640223583917
207.0,0.9360580171533267
208.0,0.9813153138044625
209.0,0.9965400238346707
					</series>
					<series title="lower limit" type="k" color="0xdd0000" encoding="csv">196.0,0.0
197.0,2.5317487491294045E-5
198.0,6.190999316495713E-4
199.0,0.005503594192313587
200.0,0.025338914929837742
201.0,0.06394198284667334
202.0,0.13404912388910878
203.0,0.25041975045140225
204.0,0.43869341194103906
205.0,0.6246139976951355
206.0,0.7884716407300623
207.0,0.9014202209520978
208.0,0.9597851126261567
209.0,0.9842979508239253
					</series>
					<series title="cumulative" type="l" color="0x000000" encoding="csv">196.0,0.0
197.0,0.001
198.0,0.003
199.0,0.011
200.0,0.036
201.0,0.08
202.0,0.156
203.0,0.278
204.0,0.47
205.0,0.655
206.0,0.814
207.0,0.92
208.0,0.972
209.0,0.992
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">203.612,0.0
203.612,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=14
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [196, 209]
Mean estimate of displayed sample: 203.612 ± 0.132629 (95% CI)</comment>
				</plot>
				<plot title="Frequency Histogram" xaxis="max: turret_count" yaxis="count">
					<series title="count" type="b(1.000000)" color="0x0000ff" encoding="csv">196.0,1.0
197.0,2.0
198.0,8.0
199.0,25.0
200.0,44.0
201.0,76.0
202.0,122.0
203.0,192.0
204.0,185.0
205.0,159.0
206.0,106.0
207.0,52.0
208.0,20.0
209.0,8.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">203.612,0.0
203.612,192.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=14
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [196, 209]
Mean estimate of displayed sample: 203.612 ± 0.132629 (95% CI)</comment>
				</plot>
			</result>
		</query>
	</queries>
</nta>
